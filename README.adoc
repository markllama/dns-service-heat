== DNS Service for OpenStack with Heat

This repository defines a simple distributed DNS service within an
OpenStack Heat stack.  The goal is to de-mystify DNS services and
deployments for low level delegated sub-domains.  It is NOT to provide
enterprise scale and quality DNS services.

== Inputs

----
parameters:
  external_network: public_network
  slave_count: 3
  image: rhel7
  ssh_key_name: ocp3
  domain_name: dns.example.com
  dns_nameservers: 10.19.114.42,10.19.114.2,10.11.5.19
----

== Deploying

----
openstack stack create -e dns_service_parameters.yaml [-e rhn_credentials.yaml] -t dns_service.yaml dns-service

----
----
openstack stack create -e dns_service_parameters.yaml -e rhn_credentials.yaml \
  -t dns_service.yaml  dns-service
----

----
openstack server ssh -i ~/osp-keys/ocp3_rsa -l cloud-user -o StrictHostKeyChecking=no \
  ns-master.dns.example.com
----


== Deploying On An Existing Network

----
openstack stack create \
  --parameter external_network=public_network \
  --parameter dns_nameservers=10.19.114.41,10.19.114.2,10.11.5.19 \
  -t dns_network.yaml \
  dns-network
----

----
openstack stack create -e dns_servers_parameters.yaml -e rhn_credentials.yaml  -t dns_servers.yaml  dns-servers
----

== Configure the DNS Service

----
python bin/stack_data.py --zone dns.example.com --update-key "your key" > dns_stack_dynamic.yaml
----

----
jinja2-2.7 ansible/inventory.j2 dns_stack_dynamic.yaml > inventory
----

----
ansible-playbook -i inventory --become --user cloud-user --private-key ../keys/ocp3_rsa --ssh-common-args "-o StrictHostKeyChecking=no" ../dns-service-playbooks/playbooks/bind-server.yml
----


== Add the glue records

----
python bin/add_a_record.py --server <master> --zone dns.example.com. --key <key> ns0 <addr>
python bin/add_ns_record.py --server <master> --zone dns.example.com. --key <key> ns0.dns.example.com.
----
